<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/web/favicons/favicon.ico><link rel=apple-touch-icon href=/web/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/web/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/web/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/web/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/web/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/web/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/web/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/web/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/web/favicons/android-192x192.png sizes=192x192><title>TKEStack 容器混合云能力介绍（2）：打破网络边界 | Tkestack</title><meta name=description content="生产级别多集群管理系统"><meta property="og:title" content="TKEStack 容器混合云能力介绍（2）：打破网络边界"><meta property="og:description" content="Author: LeoRyu
TKEStack 提供了多集群管理能力，其中导入集群功能通过推送模式由 TKEStack 管控集群（global cluster）直连第三方集群的 api-server 进而统一纳管部署在 IDC，公有云或边缘的第三方集群。 但在实际生产环境中， 管控集群和第三方集群之间的直连往往会出现很多阻碍：或是不在同一个二层网络下，或是第三方集群在防火墙/NAT之后，或是第三方集群在网络策略上不允许有入站网络传输，在这些场景下, TKEStack难以直连第三方集群 api-server, 导入集群的能力无法发挥。针对这一问题本文将介绍 TKEStack 如何借助腾讯云原生分布式云中心注册集群的功能打破网络边界的限制，将网络环境相对隔离的集群纳入到 TKEStack 的管控面，进行统一管控。
TKEStack 的导入集群功能 开源版 TKEStack 的集群管理中[1]存在两种集群的概念，一种是独立集群，另一种是导入集群。
其中独立集群需要用户提供可被 TKEStack 访问的 Linux 机器的访问凭证，TKEStack 将以用户提供的机器作为基础设施，从 0 搭建可被 TKEStack 管控的 K8s 集群。
导入集群则是将用户的现存集群纳入到 TKEStack 的管控之下，但需要此集群可以被 TKEStack 访问到（无需被导入集群可访问 TKEStack），用户在满足此条件前提下可提供被导入集群的访问凭证，便可将集群纳入到 TKEStack 管控视野内。
但是在现实生产环境中，被导入集群有极大的可能性处于外网无法访问的网络环境中，此时我们可以借助腾讯云的分布式云中心来打通 TKEStack 与被导入集群间的网络边界限制。
打破网络边界 云原生分布式云中心（Tencent Kubernetes Engine Distributed Cloud Center，TDCC）[2] 是腾讯面向多云多集群场景的应用管理平台，支持用户将云原生化的应用扩展到分布式云，打通公有云、私有云、边缘云的界限，将各种成熟的集群、网络、存储、微服务、运维等公有云产品和服务交付至更接近用户和数据的位置，确保不同云基础设施下拥有一致的控制平面，并且提供可靠性保证和安全合规保证，满足企业用户的多云管理、应用治理、高可用容灾等场景诉求。
下面笔者将演示在家庭网络环境下（可访问公网）使用 kind[3] 创建一个 K8s 集群，并借助分布式云中心，将其导入一个私有云网络环境下（可访问公网）的 TKEStack。由于 TKEStack 在 v1.8 release 时云原生分布式云中心还未上线，这里需要我们使用 daily build 版本进行体验，该功能的正式发布则需要等到稍晚些 TKEStack v1."><meta property="og:type" content="article"><meta property="og:url" content="/web/zh/blog/2021/12/20/hybrid-cloud-introduction-2/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-12-20T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-20T00:00:00+00:00"><meta property="og:site_name" content="Tkestack"><meta itemprop=name content="TKEStack 容器混合云能力介绍（2）：打破网络边界"><meta itemprop=description content="Author: LeoRyu
TKEStack 提供了多集群管理能力，其中导入集群功能通过推送模式由 TKEStack 管控集群（global cluster）直连第三方集群的 api-server 进而统一纳管部署在 IDC，公有云或边缘的第三方集群。 但在实际生产环境中， 管控集群和第三方集群之间的直连往往会出现很多阻碍：或是不在同一个二层网络下，或是第三方集群在防火墙/NAT之后，或是第三方集群在网络策略上不允许有入站网络传输，在这些场景下, TKEStack难以直连第三方集群 api-server, 导入集群的能力无法发挥。针对这一问题本文将介绍 TKEStack 如何借助腾讯云原生分布式云中心注册集群的功能打破网络边界的限制，将网络环境相对隔离的集群纳入到 TKEStack 的管控面，进行统一管控。
TKEStack 的导入集群功能 开源版 TKEStack 的集群管理中[1]存在两种集群的概念，一种是独立集群，另一种是导入集群。
其中独立集群需要用户提供可被 TKEStack 访问的 Linux 机器的访问凭证，TKEStack 将以用户提供的机器作为基础设施，从 0 搭建可被 TKEStack 管控的 K8s 集群。
导入集群则是将用户的现存集群纳入到 TKEStack 的管控之下，但需要此集群可以被 TKEStack 访问到（无需被导入集群可访问 TKEStack），用户在满足此条件前提下可提供被导入集群的访问凭证，便可将集群纳入到 TKEStack 管控视野内。
但是在现实生产环境中，被导入集群有极大的可能性处于外网无法访问的网络环境中，此时我们可以借助腾讯云的分布式云中心来打通 TKEStack 与被导入集群间的网络边界限制。
打破网络边界 云原生分布式云中心（Tencent Kubernetes Engine Distributed Cloud Center，TDCC）[2] 是腾讯面向多云多集群场景的应用管理平台，支持用户将云原生化的应用扩展到分布式云，打通公有云、私有云、边缘云的界限，将各种成熟的集群、网络、存储、微服务、运维等公有云产品和服务交付至更接近用户和数据的位置，确保不同云基础设施下拥有一致的控制平面，并且提供可靠性保证和安全合规保证，满足企业用户的多云管理、应用治理、高可用容灾等场景诉求。
下面笔者将演示在家庭网络环境下（可访问公网）使用 kind[3] 创建一个 K8s 集群，并借助分布式云中心，将其导入一个私有云网络环境下（可访问公网）的 TKEStack。由于 TKEStack 在 v1.8 release 时云原生分布式云中心还未上线，这里需要我们使用 daily build 版本进行体验，该功能的正式发布则需要等到稍晚些 TKEStack v1."><meta itemprop=datePublished content="2021-12-20T00:00:00+00:00"><meta itemprop=dateModified content="2021-12-20T00:00:00+00:00"><meta itemprop=wordCount content="354"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="TKEStack 容器混合云能力介绍（2）：打破网络边界"><meta name=twitter:description content="Author: LeoRyu
TKEStack 提供了多集群管理能力，其中导入集群功能通过推送模式由 TKEStack 管控集群（global cluster）直连第三方集群的 api-server 进而统一纳管部署在 IDC，公有云或边缘的第三方集群。 但在实际生产环境中， 管控集群和第三方集群之间的直连往往会出现很多阻碍：或是不在同一个二层网络下，或是第三方集群在防火墙/NAT之后，或是第三方集群在网络策略上不允许有入站网络传输，在这些场景下, TKEStack难以直连第三方集群 api-server, 导入集群的能力无法发挥。针对这一问题本文将介绍 TKEStack 如何借助腾讯云原生分布式云中心注册集群的功能打破网络边界的限制，将网络环境相对隔离的集群纳入到 TKEStack 的管控面，进行统一管控。
TKEStack 的导入集群功能 开源版 TKEStack 的集群管理中[1]存在两种集群的概念，一种是独立集群，另一种是导入集群。
其中独立集群需要用户提供可被 TKEStack 访问的 Linux 机器的访问凭证，TKEStack 将以用户提供的机器作为基础设施，从 0 搭建可被 TKEStack 管控的 K8s 集群。
导入集群则是将用户的现存集群纳入到 TKEStack 的管控之下，但需要此集群可以被 TKEStack 访问到（无需被导入集群可访问 TKEStack），用户在满足此条件前提下可提供被导入集群的访问凭证，便可将集群纳入到 TKEStack 管控视野内。
但是在现实生产环境中，被导入集群有极大的可能性处于外网无法访问的网络环境中，此时我们可以借助腾讯云的分布式云中心来打通 TKEStack 与被导入集群间的网络边界限制。
打破网络边界 云原生分布式云中心（Tencent Kubernetes Engine Distributed Cloud Center，TDCC）[2] 是腾讯面向多云多集群场景的应用管理平台，支持用户将云原生化的应用扩展到分布式云，打通公有云、私有云、边缘云的界限，将各种成熟的集群、网络、存储、微服务、运维等公有云产品和服务交付至更接近用户和数据的位置，确保不同云基础设施下拥有一致的控制平面，并且提供可靠性保证和安全合规保证，满足企业用户的多云管理、应用治理、高可用容灾等场景诉求。
下面笔者将演示在家庭网络环境下（可访问公网）使用 kind[3] 创建一个 K8s 集群，并借助分布式云中心，将其导入一个私有云网络环境下（可访问公网）的 TKEStack。由于 TKEStack 在 v1.8 release 时云原生分布式云中心还未上线，这里需要我们使用 daily build 版本进行体验，该功能的正式发布则需要等到稍晚些 TKEStack v1."><link rel=preload href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css as=style><link href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/web/zh/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Tkestack</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/docs/><span>Docs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文 Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/web/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文 Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/web/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-webzhblog-li><a href=/web/zh/blog/ title="TKEStack 博客" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root" id=m-webzhblog><span>博客</span></a><ul class="pr-md-3 ul-1"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-webzhblog20220318tkestack-casbin-authz-li><a href=/web/zh/blog/2022/03/18/tkestack-casbin-authz/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-webzhblog20220318tkestack-casbin-authz><span>TKEStack授权链路源码解析</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-webzhblog20220223tkestack-installer-chart-li><a href=/web/zh/blog/2022/02/23/tkestack-installer-chart/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-webzhblog20220223tkestack-installer-chart><span>原生k8s集群上通过chart安装tke-auth、tke-platform、tke-gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-webzhblog20220104tkestack-ldap-li><a href=/web/zh/blog/2022/01/04/tkestack-ldap/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-webzhblog20220104tkestack-ldap><span>TKEStack 集成LDAP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-webzhblog20211220hybrid-cloud-introduction-2-li><a href=/web/zh/blog/2021/12/20/hybrid-cloud-introduction-2/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__page" id=m-webzhblog20211220hybrid-cloud-introduction-2><span class=td-sidebar-nav-active-item>TKEStack 容器混合云能力介绍（2）：打破网络边界</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-webzhblog20211218tkestack-auth-li><a href=/web/zh/blog/2021/12/18/tkestack-auth/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-webzhblog20211218tkestack-auth><span>TKEStack 中的认证与鉴权</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-webzhblog20210901container-runtime-migraion-li><a href=/web/zh/blog/2021/09/01/container-runtime-migraion/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-webzhblog20210901container-runtime-migraion><span>TKEStack 集群容器运行时迁移</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-webzhblog20210802hybrid-cloud-introduction-1-li><a href=/web/zh/blog/2021/08/02/hybrid-cloud-introduction-1/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-webzhblog20210802hybrid-cloud-introduction-1><span>TKEStack 容器混合云能力介绍（1）：统一基石</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-webzhblog20210609tkestack-indtroduction-2021-li><a href=/web/zh/blog/2021/06/09/tkestack-indtroduction-2021/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__page" id=m-webzhblog20210609tkestack-indtroduction-2021><span>腾讯开源容器云平台 TKEStack 介绍</span></a></li></ul></li></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/tkestack/web/edit/master/content/zh/blog/2021-12-20-TKEStack%e5%ae%b9%e5%99%a8%e6%b7%b7%e5%90%88%e4%ba%91%e8%83%bd%e5%8a%9b%e4%bb%8b%e7%bb%8d-2/index.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/tkestack/web/new/master/content/zh/blog/2021-12-20-TKEStack%e5%ae%b9%e5%99%a8%e6%b7%b7%e5%90%88%e4%ba%91%e8%83%bd%e5%8a%9b%e4%bb%8b%e7%bb%8d-2/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/tkestack/web/issues/new?title=TKEStack%20%e5%ae%b9%e5%99%a8%e6%b7%b7%e5%90%88%e4%ba%91%e8%83%bd%e5%8a%9b%e4%bb%8b%e7%bb%8d%ef%bc%882%ef%bc%89%ef%bc%9a%e6%89%93%e7%a0%b4%e7%bd%91%e7%bb%9c%e8%be%b9%e7%95%8c" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a id=print href=/web/zh/blog/_print/><i class="fa fa-print fa-fw"></i> 整节打印</a></div><nav id=TableOfContents><ul><li><a href=#tkestack-的导入集群功能>TKEStack 的导入集群功能</a></li><li><a href=#打破网络边界>打破网络边界</a><ul><li><a href=#创建-kind-集群>创建 kind 集群</a></li><li><a href=#注册集群到分布式云中心>注册集群到分布式云中心</a></li><li><a href=#导入集群到-tkestack>导入集群到 TKEStack</a></li></ul></li><li><a href=#原理>原理</a></li><li><a href=#加入我们>加入我们</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>TKEStack 容器混合云能力介绍（2）：打破网络边界</h1><div class="td-byline mb-4"><time datetime=2021-12-20 class=text-muted>2021.12.20</time></div><p><strong>Author</strong>: LeoRyu</p><p><em>TKEStack 提供了多集群管理能力，其中导入集群功能通过推送模式由 TKEStack 管控集群（global cluster）直连第三方集群的 api-server 进而统一纳管部署在 IDC，公有云或边缘的第三方集群。 但在实际生产环境中， 管控集群和第三方集群之间的直连往往会出现很多阻碍：或是不在同一个二层网络下，或是第三方集群在防火墙/NAT之后，或是第三方集群在网络策略上不允许有入站网络传输，在这些场景下, TKEStack难以直连第三方集群 api-server, 导入集群的能力无法发挥。针对这一问题本文将介绍 TKEStack 如何借助腾讯云原生分布式云中心注册集群的功能打破网络边界的限制，将网络环境相对隔离的集群纳入到 TKEStack 的管控面，进行统一管控。</em></p><h2 id=tkestack-的导入集群功能>TKEStack 的导入集群功能</h2><p>开源版 TKEStack 的集群管理中<sup>[1]</sup>存在两种集群的概念，一种是<code>独立集群</code>，另一种是<code>导入集群</code>。</p><p>其中<code>独立集群</code>需要用户提供可被 TKEStack 访问的 Linux 机器的访问凭证，TKEStack 将以用户提供的机器作为基础设施，从 0 搭建可被 TKEStack 管控的 K8s 集群。</p><img alt=独立集群 width=100% src=baremetal-cluster.png><p><code>导入集群</code>则是将用户的现存集群纳入到 TKEStack 的管控之下，但需要此集群可以被 TKEStack 访问到（无需被导入集群可访问 TKEStack），用户在满足此条件前提下可提供被导入集群的访问凭证，便可将集群纳入到 TKEStack 管控视野内。</p><img alt=导入集群 width=100% src=import-cluster.png><p>但是在现实生产环境中，被导入集群有极大的可能性处于外网无法访问的网络环境中，此时我们可以借助腾讯云的分布式云中心来打通 TKEStack 与被导入集群间的网络边界限制。</p><h2 id=打破网络边界>打破网络边界</h2><p>云原生分布式云中心（Tencent Kubernetes Engine Distributed Cloud Center，TDCC）<sup>[2]</sup> 是腾讯面向多云多集群场景的应用管理平台，支持用户将云原生化的应用扩展到分布式云，打通公有云、私有云、边缘云的界限，将各种成熟的集群、网络、存储、微服务、运维等公有云产品和服务交付至更接近用户和数据的位置，确保不同云基础设施下拥有一致的控制平面，并且提供可靠性保证和安全合规保证，满足企业用户的多云管理、应用治理、高可用容灾等场景诉求。</p><p>下面笔者将演示在家庭网络环境下（可访问公网）使用 kind<sup>[3]</sup> 创建一个 K8s 集群，并借助分布式云中心，将其导入一个私有云网络环境下（可访问公网）的 TKEStack。由于 TKEStack 在 v1.8 release 时云原生分布式云中心还未上线，这里需要我们使用 daily build 版本进行体验，该功能的正式发布则需要等到稍晚些 TKEStack v1.9.0 发布，daily build 版本下载可参考以下命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>=</span>310e18e0d696ee0aa57dfe38655b99726eab9f5c <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> wget https://tke-release-1251707795.cos.ap-guangzhou.myqcloud.com/tke-installer-linux-amd64-<span style=color:#000>$version</span>.run<span style=color:#ce5c00;font-weight:700>{</span>,.sha256<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> sha256sum --check --status tke-installer-linux-amd64-<span style=color:#000>$version</span>.run.sha256 <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> chmod +x tke-installer-linux-amd64-<span style=color:#000>$version</span>.run <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> ./tke-installer-linux-amd64-<span style=color:#000>$version</span>.run
</code></pre></div><h3 id=创建-kind-集群>创建 kind 集群</h3><p>这里笔者在自己的虚拟机上使用 kind 创建一个集群，首先是安装 kind：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.11.1/kind-linux-amd64
chmod +x ./kind
mv kind /usr/bin/
</code></pre></div><p>然后我们执行 kind 的创建集群命令：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kind create cluster
</code></pre></div><p>如果不出意外我们将在等待一段时间后得到以下结果：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Creating cluster <span style=color:#4e9a06>&#34;kind&#34;</span> ...
 ✓ Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.21.1<span style=color:#ce5c00;font-weight:700>)</span> 🖼 
 ✓ Preparing nodes 📦  
 ✓ Writing configuration 📜 
 ✓ Starting control-plane 🕹️ 
 ✓ Installing CNI 🔌 
 ✓ Installing StorageClass 💾 
Set kubectl context to <span style=color:#4e9a06>&#34;kind-kind&#34;</span>
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Not sure what to <span style=color:#204a87;font-weight:700>do</span> next? 😅  Check out https://kind.sigs.k8s.io/docs/user/quick-start/
</code></pre></div><p>下面可以使用 kubectl 来确认一下集群是否在正常运行，这里我们就完成了 kind 集群的创建工作。如果你的机器上没有 kubectl 可以参考<a href=https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/>Install and Set Up kubectl on Linux
</a>进行安装。</p><h3 id=注册集群到分布式云中心>注册集群到分布式云中心</h3><p>访问腾讯云的<a href=https://console.cloud.tencent.com/tdcc/cluster>分布式云中心主页</a>，选择注册集群按钮。</p><img alt=注册集群1 width=100% src=register-cluster-1.png><p>这里由于我们是通过 kind 创建的集群并非 TKE，所以注意选择非 TKE 集群。</p><img alt=注册集群2 width=100% src=register-cluster-2.png><p>注册集群创建成功后改集群将处于等待注册的状态，点击查看注册命令。</p><img alt=注册集群3 width=100% src=register-cluster-3.png><p>由于我们的 kind 集群无法无法通过内外与分布式云中心通信，注意选择外网访问。</p><img alt=注册集群4 width=100% src=register-cluster-4.png><p>根据提示将<code>agent.yaml</code>下载下来然后通过 kubectl 部署到 kind 集群：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl apply -f agent.yaml
</code></pre></div><p>如果顺利我们将会得到以下反馈：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>namespace/clusternet-system created
serviceaccount/clusternet-agent created
serviceaccount/clusternet-app-deployer created
deployment.apps/clusternet-agent created
clusterrole.rbac.authorization.k8s.io/clusternet:app:deployer created
clusterrolebinding.rbac.authorization.k8s.io/clusternet:app:deployer created
secret/clusternet-agent-cluster-registration created
</code></pre></div><p>此时可以通过下面的命令确认下 agent 相关 pod 是否正常工作：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get pod -n clusternet-system
</code></pre></div><p>如果正常我们应当会得到类似下面的反馈：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>NAMESPACE            NAME                                         READY   STATUS    RESTARTS   AGE
clusternet-system    clusternet-agent-6754cc97bb-dk6r4            1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          8s
clusternet-system    clusternet-agent-6754cc97bb-sbpzg            1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          8s
clusternet-system    clusternet-agent-6754cc97bb-zfblp            1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          8s
</code></pre></div><p>再检查分布式云中心首页我们将发现 kind 集群已经成功注册了进来。</p><h3 id=导入集群到-tkestack>导入集群到 TKEStack</h3><p>下面我们将把 kind 集群导入到 TKEStack 中，首先从分布式云中心将集群的访问凭证下载下来。</p><img alt=注册集群5 width=100% src=register-cluster-5.png>
<img alt=注册集群6 width=100% src=register-cluster-6.png><p>然后使用此凭证便可将 kind 集群导入到 TKEStack 中。</p><img alt=注册集群7 width=100% src=register-cluster-7.png>
<img alt=注册集群8 width=100% src=register-cluster-8.png>
<img alt=注册集群9 width=100% src=register-cluster-9.png><h2 id=原理>原理</h2><p>腾讯云分布式云中心的核心功能由 Clusternet<sup>[4]</sup> 提供，该项目已经开源，可以在 <a href=https://github.com/clusternet/clusternet>https://github.com/clusternet/clusternet</a> 仓库下查看代码。</p><p>Clusternet 的核心能力通过<code>clusternet-hub</code>和<code>clusternet-agent</code>两个组件实现，<code>clusternet-hub</code>的角色类似一个电插板，以 aggregated apiserver<sup>[5]</sup> 形式部署在父集群中等待着子集群被接入进来；<code>clusternet-agent</code>则在子集群中充当一个派驻信使的角色，一方面将子集群的信息上报给<code>clusternet-hub</code>以进行观测，另一方面将从<code>clusternet-hub</code>传送来的指令下发给子集群以进行控制。鉴权模式上 Clusternet 复用了子集群的鉴权能力，通过 K8s 的 user impersonation<sup>[6]</sup> 能力将认证信息发送到<code>clusternet-agent</code>模拟对应用户进行操作控制。</p><img alt=clusternet架构 width=100% src=clusternet-arch.png><h2 id=加入我们>加入我们</h2><p>在大家的共同努力下 TKEStack 已经演进到 v1.8.x 版本，其中包括了 containerd 支持、cilium 支持、集群应用定义等诸多新功能，欢迎大家到 <a href=https://github.com/tkestack/tke/releases>https://github.com/tkestack/tke/releases</a> 下载体验。同时 v1.9.0 版本的开发工作正在主分支上火热进行中，v1.9.0 版本中除了本文介绍的支持导入分布式云中心集群外，我们会全面升级 TKEStack 的各种依赖，包括 golang 版本、CI 工具版本以及 K8s api 版本等，此外我们还将在 TKEStack 的轻量化减负上做出努力，包括移除 TKE 发行版<sup>[7]</sup>以外的集群版本，删减不常用的 addon 组件等。当下的 TKEStack 正是需要你加入的时候，欢迎大家到项目仓库 <a href=https://github.com/tkestack/tke>https://github.com/tkestack/tke</a> 贡献一份力量！</p><h2 id=参考资料>参考资料</h2><p>[1] TKEStack 集群管理 [https://tkestack.github.io/docs/user-guide/platform-console/cluster-mgmt.html]</p><p>[2] 腾讯云原生分布式云中心 [https://cloud.tencent.com/document/product/1517/63246]</p><p>[3] Kind, running local Kubernetes clusters using Docker [https://kind.sigs.k8s.io/]</p><p>[4] Clusternet [https://github.com/clusternet/clusternet]</p><p>[5] Kubernetes API Aggregation Layer [https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/]</p><p>[6] User impersonation [https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation]</p><p>[7] TKE Kubernetes Distro [https://github.com/tkestack/tke-k8s-distro]</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/web/zh/blog/2021/12/18/tkestack-auth/ aria-label="上一页 - TKEStack 中的认证与鉴权" class="btn btn-primary"><span class=mr-1>←</span> 上一页</a></li><a href=/web/zh/blog/2022/01/04/tkestack-ldap/ aria-label="下一页 - TKEStack 集成LDAP" class="btn btn-primary">下一页 <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/tkestack/tke aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The TKEStack Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/web/js/main.min.1911ee3ae98d7d6df3807cd00d8e31ae7d1c08ee0f0bb587529b0483da4e5464.js integrity="sha256-GRHuOumNfW3zgHzQDY4xrn0cCO4PC7WHUpsEg9pOVGQ=" crossorigin=anonymous></script></body></html>